---
import { parseHTML } from "linkedom";
import Markdown from "@astrojs/markdown-component";
import { Picture } from "astro-imagetools/components";

const { page } = Astro.props;

// @ts-ignore
const infoBlocksHTML = await Astro.__renderMarkdown(page.Block3);

const { document: infoBlocksDocument } = await parseHTML(infoBlocksHTML),
  titles = [...infoBlocksDocument.querySelectorAll("h2")];
---

<style>
  .info-block-title {
    @apply leading-tight underline decoration-[3px];

    font-size: clamp(1.75rem, 3.6vw + 0.01rem, 3.125rem);
    margin-top: clamp(1.125rem, 1.5vw + 0.3rem, 1.563rem);
  }

  .info-block-text {
    font-size: clamp(1rem, 1.5vw + 0.1rem, 1.5rem);
    margin-top: clamp(1.125rem, 1.5vw + 0.3rem, 1.563rem);
  }
</style>

<section
  class="flex flex-wrap items-center gap-y-20 py-20 py-[50px] lg:py-[75px]"
>
  {
    titles.map((title, index) => {
      const isEven = index % 2 === 0,
        { textContent: titleText } = title,
        { textContent } = title.nextElementSibling,
        // @ts-ignore
        { src: imgSrc } = title.nextElementSibling.lastElementChild;

      return (
        <div class="flex flex-wrap items-center">
          <div
            class:list={[
              "relative w-full sm:w-1/2 order-1 mb-4 sm:mb-0",
              isEven
                ? "pr-0 sm:pr-5 md:pr-12 lg:pr-24"
                : "sm:order-2 pl-0 sm:pl-5 md:pl-12 lg:pl-24",
            ]}
          >
            <Picture
              alt=""
              src={imgSrc}
              attributes={{
                picture: {
                  style: "clip-path: url(#estate-img-curve);",
                },
              }}
            />
          </div>

          {/* Text content */}
          <div
            class:list={[
              "order-2 w-full sm:w-1/2",
              isEven ? "pr-0 sm:pr-5" : "sm:order-1 pl-0 sm:pl-5",
            ]}
          >
            <h2 class="info-block-title alice text-primary">{titleText}</h2>

            <div class="info-block-text block prose max-w-none pt-5 text-dark leading-normal line-clamp-5">
              <Markdown>{textContent}</Markdown>
            </div>
          </div>
        </div>
      );
    })
  }
</section>
