<script is:inline>
    /* Redirection Script */
    // Placed in head as it should run before everything else

    const allLocales = ["en", "nl", "de"], // List available locales
        locale = document.documentElement.lang, // get current document locale
        browserLocale = navigator.language.substring(0, 2) // get browser locale
    
    let preferredLocale = localStorage.getItem('locale') // locale stored in browser storage

    if (preferredLocale == null) { // if no stored locale use browser locale if it exists in the list
        preferredLocale = allLocales.includes(browserLocale) ? browserLocale : "en"

        localStorage.setItem(`locale`, preferredLocale)
    }
    
    if (locale != preferredLocale) { // redirect if stored locale and document locale differ
        let newPath

        if (locale == "en") {
            newPath = `/${preferredLocale}${location.pathname}`
        } else {
            const [, , ...urlParts] = location.pathname.split("/")

            newPath = `/${preferredLocale === 'en' ? '' : `${preferredLocale}/`}${urlParts.join('/')}`
        }

        location.pathname = newPath
    }
</script>