---
import { Picture } from "astro-imagetools/components";

import Markdown from "@components/Markdown.astro";
import ClipPathSVG from "@components/ClipPathSVG.astro";

import CMS from "@store/CMS";
import RecurringImages from "@store/RecurringImages";

const { white_right_arrow } = RecurringImages;

const { page, text, posts, heading } = Astro.props,
  { locale } = page,
  { STRAPI_URL } = import.meta.env;

const recurData = CMS.get("recurringElement", locale),
  ariaLabelRecurData = CMS.get("ariaLabelRecurringElement", locale);

const headingName = heading || recurData.text_explore_the_world_of_kindness;
---

{
  posts?.length > 0 && (
    <section role="complementary">
      <ClipPathSVG
        id="blob-card-curve"
        path="M0.99,0.554 V0.735 c0,0.331,-0.079,0.243,-0.519,0.258 S0.004,1,0.004,0.718 c0,-0.037,0.004,-0.093,0.001,-0.164 C-0.005,0.353,-0.003,0.148,0.042,0.078 C0.102,-0.013,0.358,0.003,0.513,0.003 c0.216,0,0.41,-0.034,0.459,0.141 C1,0.309,0.995,0.441,0.99,0.554"
      />

      <div class="wrapper division-gap grid mb-[50px]">
        <div class="division-in-gap grid">
          <h2 class="text-h2 text-primary">{headingName}</h2>

          {text && (
            <div class="prose-text">
              <Markdown>{text}</Markdown>
            </div>
          )}
        </div>

        <div
          role="list"
          aria-label={ariaLabelRecurData.Kindness_Items_text}
          class:list={[
            "grid grid-cols-2 lg:grid-cols-3 card-gap overflow-hidden",
          ]}
        >
          {posts.slice(0, 3).map((post, index) => (
            <div
              role="listitem"
              aria-label={ariaLabelRecurData.Kindness_Item_text + (index + 1)}
              class="link-section post-card"
            >
              <Picture
                layout="fullWidth"
                alt={post.Intro_blob.data.attributes.alternativeText}
                src={STRAPI_URL + post.Intro_blob.data.attributes.url}
                attributes={{ img: { style: "aspect-ratio: 6 / 5;" } }}
                sizes={[
                  "(min-width: 1024px) calc((100vw - min(200px, 10vw) - (clamp(24px, 3.125vw - 8px, 32px) * 2)) / 3)",
                  "(min-width: 640px) calc(45vw - 16px)",
                  "min(90vw, 380px)",
                ].join(", ")}
              />

              <div class="card-content-container">
                <div class="product-card-content">
                  {post.authors && (
                    <div class="quick-info-secondary-light-sm">
                      <div
                        role="presentation"
                        aria-label={post.authors.data.map(
                          ({ attributes }, i) =>
                            ariaLabelRecurData.Wrote_by_text +
                            (i > 0 ? ", " : " ") +
                            attributes.givenName,
                        )}
                        class="author-name"
                      >
                        {post.authors.data.map(({ attributes }, index) => (
                          <span>
                            {`${index > 0 ? ", " : " "}` + attributes.givenName}
                          </span>
                        ))}
                      </div>

                      <div class="quick-info-item">
                        {new Date(post.createdAt).toLocaleString("en-US", {
                          day: "numeric",
                          month: "long",
                        })}
                      </div>
                    </div>
                  )}

                  <div>
                    <a
                      class="main-link post-title"
                      set:text={post.Title}
                      href={`/` + post.Meta.URL_slug}
                    />

                    {!page.related_products && (
                      <img
                        class="post-title-icon ml-2"
                        {...white_right_arrow}
                      />
                    )}
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  )
}
