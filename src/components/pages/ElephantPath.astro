---
import Markdown from "@astrojs/markdown-component";

import ClipPathSVG from "@components/ClipPathSVG.astro";
import ClippedPicture from "@components/ClippedPicture.astro";
import KindnessImpact from "@components/KindnessImpact.astro";

import PostDetailsLayout from "@layouts/PostDetailsLayout.astro";

const { page, recurData, ariaLabelRecurData } = Astro.props,
  { locale } = page,
  { ASSETS_URL } = import.meta.env;
---

<style lang="scss">
  @use "src/styles/typography";
  @use "src/styles/poly-fluid" as *;

  .post-title {
    @apply font-bold leading-[130%];

    font-size: clamp(1.75rem, 3.5vw + 0.01rem, 3rem);
  }

  .post-intro {
    @apply line-clamp-3 sm:line-clamp-4 md:line-clamp-5 lg:line-clamp-6;

    font-size: clamp(1rem, 1.5vw + 0.15rem, 1.5rem);
    line-height: 150%;
  }

  .information-post-icon {
    @apply w-full h-full mx-auto;

    width: poly-fluid-clamp(
      (
        375px: 150px,
        1440px: 260px,
      )
    );
    height: poly-fluid-clamp(
      (
        375px: 150px,
        1440px: 260px,
      )
    );
  }

  .info-section {
    @media (min-width: 640px) {
      clip-path: url(#info-bg-curve);
    }
  }

  .info-container,
  .info-image-container {
    padding: poly-fluid-clamp(
      (
        640px: 25px,
        1440px: 60px,
      )
    );
    @apply px-0;
  }

  .info-img-curve-container {
    @apply pr-0;

    @media (min-width: 640px) {
      @apply pr-[7vw];
    }

    @media (min-width: 700px) {
      @apply pr-[5vw] md:pr-[3vw];
    }
  }
  .info-img-curve {
    @media (min-width: 640px) {
      clip-path: url(#info-image-curve);
    }
  }

  .heading-title {
    @apply font-semibold leading-[130%] text-black;

    font-family: typography.$recoleta;
    font-size: clamp(2.625rem, 3vw + 0.3rem, 3rem);
  }

  .info-intro {
    @apply text-[clamp(1rem,1.5vw+0.15rem,1.5rem)] leading-[150%] text-white
      md:line-clamp-5 mt-[15px] overflow-hidden;
  }
</style>

<ClipPathSVG
  id="info-bg-curve"
  path="M1,0.055 S0.962,-0.005,0.847,0 C0.729,0.006,0.602,0.049,0.484,0.044 C0.381,0.04,0.239,0.018,0.136,0.028 C0.073,0.034,0,0.055,0,0.055 V0.965 s0.032,0.035,0.156,0.035 c0.061,0,0.136,-0.012,0.193,-0.027 c0.06,-0.016,0.161,-0.017,0.231,-0.017 c0.074,0,0.2,0.037,0.315,0.01 s0.106,-0.071,0.106,-0.071 V0.055"
/>

<PostDetailsLayout
  {page}
  {recurData}
  {ariaLabelRecurData}
  nonBlog="nonBlog"
  type="section"
>
  <div slot="elephant-path-page-sections" class="my-[50px]">
    <div class="grid gap-y-[50px]">
      <section role="main">
        <div class="wrapper grid gap-5 pb-[50px]">
          <div
            id="description"
            role="list"
            aria-label={ariaLabelRecurData.All_posts_text}
            class="flex flex-wrap items-center gap-y-20 sm:gap-y-[150px]"
          >
            {
              page.Description.map(({Title, Intro_text, Blob: {data: blob}, Blog: {data: blog}}, index) => {
                const isEven = index % 2 === 0;

                return (
                  <div
                    role="listitem"
                    aria-label={`${ariaLabelRecurData.Kindness_Item + (index + 1)} ${
                      ariaLabelRecurData.Kindness_items_of_text
                    } ${page.Description.length}`}
                    class="link-section flex flex-wrap items-center"
                  >
                    <div
                      class:list={[
                        "relative w-full sm:w-1/2 order-1 mb-[25px] sm:mb-0",
                        !isEven && "sm:order-2",
                      ]}
                    >
                      <div class="w-full h-full mx-auto">
                        <img 
                          class="information-post-icon" 
                          src={ASSETS_URL + blob?.attributes.url} 
                          alt={blob?.attributes.alternativeText}
                        />
                      </div>
                    </div>

                    {/* Text content */}
                    <div
                      class:list={[
                        "order-2 w-full sm:w-1/2 h-full flex flex-wrap",
                        !isEven && "sm:order-1",
                      ]}
                    >
                      <div>

                        <h2 class="post-title recoleta text-primary pt-[15px]">
                          <a
                            class="main-link"
                            href={ blog !== null ? (`/` + blog?.attributes.Meta.URL_slug) : "#"}
                            set:text={Title || blog?.attributes.Title}
                          />
                          <span class="icon heading-inline-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 49 49" class="w-full h-full">
                              <circle cx="24.5" cy="24.5" r="24.5" style="fill:#547b7d"/>
                              <path d="M10.6,24.3a1.5,1.5,0,0,1,.9-.7,2,2,0,0,1,1.1.2c4.4,2.9,8.3,1.3,11.6-.4l7.3-3.9-5.6-1.8-.5-.2-.3-.4a1.4,1.4,0,0,1-.2-.6A.7.7,0,0,1,25,16a.5.5,0,0,1,.3-.5.8.8,0,0,1,.4-.4h1.1l8.8,2.7a2.2,2.2,0,0,1,.9.7,1.4,1.4,0,0,1,0,1.1l-2.7,8.9a2.7,2.7,0,0,1-.7.8H32a1.6,1.6,0,0,1-.8-.6,1.4,1.4,0,0,1-.1-1.1L32.8,22l-7.3,3.8c-3.4,1.8-8.7,4.1-14.4.4a1.3,1.3,0,0,1-.7-.9A1.8,1.8,0,0,1,10.6,24.3Z" style="fill:#fff"/>
                            </svg>
                          </span>
                        </h2>

                        <div class="post-intro pt-[15px] prose max-w-none">
                          <Markdown>{Intro_text || blog?.attributes.Intro_text}</Markdown>
                        </div>
                      </div>
                    </div>
                  </div>
                );
              })
            }
          </div>
        </div>
      </section>

      {/* Info Section */}
      <section
        role="complementary"
        class="info-section"
      >
        <div class="info-container overflow-x-hidden relative bg-primary w-full">
          <div class="info-content-container wrapper flex flex-wrap items-center">
            {/* Text Content */}
            <div
              class="w-full sm:w-1/2 flex flex-col sm:order-2 pb-14 sm:pb-0 z-10"
            >
              <h2 class="heading-primary font-bold text-white">
                {page.Block2_title}
              </h2>

              <div class="prose max-w-none hero-text info-intro">
                <Markdown>{page.Block2_text}</Markdown>
              </div>

              {
                page?.Block2_button_text && (
                  <a
                    href={page.Block2_button_link}
                    class:list={[
                      "flex w-fit text-primary font-bold leading-[150%]",
                      "py-[10px] px-[35px] mt-[15px] bg-white rounded-full",
                    ]}
                  >
                    {page.Block2_button_text}
                  </a>
                )
              }
            </div>

            {/* Blob Image - Desktop View */}

            <div class="hidden sm:flex sm:w-1/2 aspect-[6/5] flex items-center">
              <div class="absolute left-0 w-full h-full info-image-container">
                <div class="info-img-curve-container h-full aspect-[6/5] my-auto grid items-center">
                  <div class="info-img-curve">
                    <ClippedPicture
                      preload="avif"
                      id="info-img-curve"
                      breakpoints={{ minWidth: 640 }}
                      alt={page.Block2_blob.data.attributes.alternativeText}
                      src={ASSETS_URL + page.Block2_blob.data.attributes.url}
                      path="M0.931,0.106 C0.795,-0.023,0.586,0.006,0.414,0.006 l-0.046,0 C0.239,0.002,0.124,-0.011,0,0.02 V0.929 c0.179,0.082,0.661,0.107,0.751,0 c0.109,-0.129,0.143,-0.281,0.179,-0.403 c0.022,-0.074,0.068,-0.167,0.069,-0.256 v-0.009 C0.999,0.206,0.981,0.153,0.931,0.106"
                      attributes={{ link: { media: "(min-width: 640px)" }, img: { style: "aspect-ratio: 6 / 5;" } }}
                      sizes={[
                        "(min-width: 768px) calc(50vw - min(100px, 5vw) - 23px)",
                        "(min-width: 640px) calc(55vw - min(100px, 5vw))",
                      ].join(", ")}
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Blob Image - Mobile View */}
        <div class="hero-img-sm-container block sm:hidden relative -mt-10 z-20 w-full">
          <ClippedPicture
            preload="avif"
            id="info-img-curve-sm"
            breakpoints={{ maxWidth: 640 }}
            alt={page.Block2_blob.data.attributes.alternativeText}
            src={ASSETS_URL + page.Block2_blob.data.attributes.url}
            path="M1 .074v.904S.906 1 .774 1C.706 1 .637.996.569.993.487.989.405.984.324.986a4.576 4.576 0 0 0-.117.005C.115.996.032 1.001 0 .986V.074C.062.024.147 0 .282 0c.075 0 .165.023.244.043.062.016.118.03.154.03.026 0 .06-.007.097-.014C.861.044.959.025 1 .074"
            attributes={{ link: { media: "(max-width: 639.98px)" } }}
          />
        </div>
      </section>

      <div class="wrapper">
        <KindnessImpact {locale} heading={page.Block3_title} impacts={page.Impacts}>
      </div>
    </div>
  </div>
</PostDetailsLayout>
