---
import CupIconG from "@images/cupLightgreen.svg";
import FlowerIconG from "@images/flowerLightgreen.svg";
import BasicPageHero from "@components/BasicPageHero.astro";

const { page, locale } = Astro.props,
  { Perk: perk, Price_EUR_excl_VAT: price } = page,
  { href: originURL } = new URL(Astro.url.pathname, Astro.site);
---

<style lang="scss">
  @use "src/styles/colors";

  .form-heading-icon {
    height: clamp(38px, 3.5vw + 6px, 58px);
  }

  .form-grid {
    @apply mt-[30px] gap-x-[60px] lg:gap-x-[40px] gap-y-[50px];

    label {
      @apply text-[1.125rem];

      color: colors.$input-label;

      input,
      select {
        border: 1px solid colors.$primary-color;

        @apply block w-full mt-2.5 px-4 py-3.5 text-lg rounded-[20px] bg-transparent;
        @apply focus:ring-emerald-800 focus:ring-opacity-20 focus:outline-none focus:ring;
      }

      select {
        &:required:invalid {
          color: colors.$input;
        }

        option[value=""][disabled] {
          display: none;
        }
      }

      input:is([type="text"], [type="email"])::placeholder {
        color: colors.$input;

        @apply text-[1.125rem];
      }
    }
  }

  input[type="submit"] {
    background-color: colors.$primary-color;
  }
</style>

<BasicPageHero title={page.Title} introText={page.Intro_text} />

{/* Form Section */}

<form
  role="main"
  method="POST"
  action="https://pay.scripts.dilmahtea.me"
  class="mx-auto pt-[130px] pb-[100px] max-w-[940px]"
>
  <div>
    <div
      class="pb-0.5 inline-flex items-center gap-x-2 sm:gap-x-3.5 md:gap-x-7"
    >
      <h2 class="heading-primary text-primary">
        {locale === "nl" ? "Basis gegevens" : "Basic info"}
      </h2>

      <img class="form-heading-icon" src={CupIconG} alt="tea-leaf-icon" />
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 form-grid">
      <label>
        {locale === "nl" ? "Voornaam" : "First Name"}

        <input
          type="text"
          id="first_name"
          name="first_name"
          placeholder={locale === "nl" ? "Voornaam" : "First Name"}
          required
        />
      </label>

      <label>
        {locale === "nl" ? "Achternaam" : "Last Name"}

        <input
          type="text"
          id="last_name"
          name="last_name"
          placeholder={locale === "nl" ? "Achternaam" : "Last Name"}
          required
        />
      </label>

      <label>
        {locale === "nl" ? "E-mailadres" : "Email Address"}

        <input
          type="email"
          id="email"
          name="email"
          placeholder={locale === "nl"
            ? "Vul je e-mailadres in"
            : "Enter your email address"}
          required
        />
      </label>

      <label>
        {locale === "nl" ? "Favoriete thee" : "Favourite Tea"}

        <input
          type="text"
          id="favorite_tea"
          name="favorite_tea"
          placeholder={locale === "nl" ? "Earl Grey" : "Black Tea"}
          required
        />
      </label>
    </div>
  </div>

  <div class="py-[50px]">
    <div class="inline-flex items-center gap-x-2 sm:gap-x-3.5 md:gap-x-7">
      <h3 class="heading-primary text-primary">
        {locale === "nl" ? "Factuurgegevens" : "Billing details"}
      </h3>

      <img class="form-heading-icon" src={FlowerIconG} alt="tea-leaf-icon" />
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 form-grid">
      <label>
        {locale === "nl" ? "Land" : "Country"}

        <select id="country" name="country" required>
          <option value="" disabled>
            {
              locale === "nl"
                ? "Selecteer jouw land"
                : "Select or type your country"
            }
          </option>

          <option value="Netherlands" selected>
            {locale === "nl" ? "Nederland" : "Netherlands"}
          </option>
        </select>
      </label>

      <label>
        {locale === "nl" ? "Plaatsnaam" : "City"}

        <input
          type="text"
          id="city"
          name="city"
          placeholder={locale === "nl"
            ? "Vul je plaatsnaam in"
            : "Enter your city address"}
          required
        />
      </label>

      <label>
        {locale === "nl" ? "Straat en huisnummer" : "Street and house number"}

        <input
          type="text"
          id="street"
          name="street"
          placeholder={locale === "nl"
            ? "Vul je straat en huisnummer in"
            : "Enter your street address"}
          required
        />
      </label>

      <label>
        {locale === "nl" ? "Postcode" : "Postal Code"}

        <input
          type="text"
          id="postal_code"
          name="postal_code"
          placeholder={locale === "nl"
            ? "Vul je postcode in"
            : "Enter your postal code"}
          required
        />
      </label>

      <input type="hidden" id="perk" name="perk" value={perk} required />

      <input type="hidden" id="locale" name="locale" value={locale} required />

      <input
        type="hidden"
        id="origin_url"
        name="origin_url"
        value={originURL}
        required
      />

      <script is:inline>
        document.currentScript.previousElementSibling.value = location.href;
      </script>

      <input
        type="hidden"
        id="plan_name"
        name="plan_name"
        value={page.Title}
        required
      />

      <input type="hidden" id="price" name="price" value={price} required />
    </div>

    <input
      type="submit"
      class:list={[
        "text-[16px] font-bold rounded-[40px] cursor-pointer",
        "w-full md:w-[300px] mt-[70px] md:mt-[100px] py-[16px] px-[30px]",
      ]}
      value={locale === "nl" ? "Naar betaalgegevens" : "To payment details"}
      required
    />
  </div>
</form>

<script>
  const params = new URLSearchParams(location.search);

  Array.from(params.entries()).forEach(([param, value]) => {
    if (param === "country") {
      const country = document.querySelector(
        `select[name="country"] option[value="${value}"]`
      );

      // @ts-ignore
      if (country) country.selected = true;
    } else {
      const input = document.querySelector(`input[name="${param}"]`);

      // @ts-ignore
      if (input) input.value = value || "";
    }
  });
</script>
