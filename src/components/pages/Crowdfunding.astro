---
import CupIcon from "/images/cup.svg";
import FlowerIcon from "/images/flower.svg";
import LoveGreenIcon from "/images/loveGreen.svg";
import MainBG from "/images/willian-justen-de-vasconcellos-_MMP5j_fCqw-unsplash.webp";
import Sec3BG from "/images/willian-justen-de-vasconcellos-_MMP5j_fCqw-unsplash_flop.webp";

import PlanCards from "../PlanCards.astro";
import Markdown from "@astrojs/markdown-component";
import UpdateHeroTopMargin from "../scripts/UpdateHeroTopMargin.astro";

const url = `${import.meta.env.CloudImg_URL}`;
const { page } = Astro.props;

const { supportersCount, totalAmountRaised } = await fetch(
  "https://crowdfunding-stats.scripts.dilmahtea.me"
).then((res) => res.json());

const goal = 100000,
  progress = totalAmountRaised / goal;

const initialProgress = `0%`,
  finalProgress = `${progress * 100}%`,
  animationDuration = 1000;
---

<!-- Hero Section -->
<div class="hero overflow-hidden relative">
  <UpdateHeroTopMargin />

  <!-- Background -->
  <svg height="0" width="0"
    ><defs
      ><clipPath id="hero-curve-1" clipPathUnits="objectBoundingBox"
        ><path
          d="M1 0v.939A.27.27 0 0 1 .828 1H.81A1.462 1.462 0 0 1 .648.987C.586.981.522.974.451.974.376.974.312.981.252.988.202.994.156 1 .11 1H.097C.009.996 0 .956 0 .956V0"
        ></path>
      </clipPath>
    </defs>
  </svg>

  <img
    src={MainBG}
    class="w-full h-full absolute"
    style="clip-path: url(#hero-curve-1);"
  />

  <!-- Text content -->

  <div class="relative h-full wrapper z-30 HeroTxtContainer">
    <div class="sm:w-1/2 lg:w-7/12 HeroTxtContent" role="banner">
      <div class="flex flex-wrap">
        <h1 class="heroTitle">
          {page.Title}
          <span class="icon relative top-0">
            <span class="relative headingInlineIcon">
              <img class="w-full h-full" src={CupIcon} alt="cup-icon" />
            </span>
          </span>
        </h1>
        <div class="prose max-w-none heroTxt">
          <Markdown>{page.Intro_text}</Markdown>
        </div>
        <a href={page.Heading_button_link}>
          <div
            class="flex items-center justify-center font-bold text-center heroBtn"
          >
            <span class="icon relative top-0">
              <span class="relative heroBtnIcon">
                <img class="w-full h-full" src={LoveGreenIcon} alt="cup-icon" />
              </span>
            </span>
            {page.Heading_button_text}
          </div>
        </a>
      </div>
    </div>
  </div>

  <!-- Blob Image  Desktop view-->

  <div class="hidden sm:block absolute z-20 h-full heroCurve2Container">
    <svg height="0" width="0"
      ><defs
        ><clipPath id="hero-curve-2" clipPathUnits="objectBoundingBox"
          ><path
            d="M1 0H.052C-.055.156.033.342.049.606.065.888.178 1 .555 1 .843 1 .918.906 1 .854"
          ></path>
        </clipPath>
      </defs>
    </svg>

    <div class="w-full h-full relative" style="clip-path: url(#hero-curve-2);">
      <img
        src={url +
        page.Intro_blob.data.attributes.provider_metadata.public_id +
        `/cms`}
        style="height: 100%; width: 100%; position: relative; right: 50px; object-fit: cover;"
      />

      <div class="absolute bottom-0 w-full progressContainer">
        <div
          style="padding: 4vw 0;"
          class="inset-0 w-auto flex justify-center mx-auto progressContentContainer"
        >
          <div
            class="w-full h-full absolute top-0 left-0 progressContentContainerBackground"
          >
          </div>

          <div class="progressContent relative">
            <div class="progressHeader">
              €<span class="total-amount-raised">{totalAmountRaised}</span>
            </div>
            <div class="flex flex-wrap gap-x-1.5 justify-between">
              <div class="progeressTxt">{page.Heading_goal}</div>
              <div class="progeressTxt">
                <span class="progeressTxtNum">{supportersCount}</span>
                {page.Heading_supporters}
              </div>
            </div>
            <div
              class="mt-1 sm:mt-2 md:mt-3 w-full bg-default-light-gray rounded-full"
            >
              <div
                style="width: 0%"
                class="progress-bar bg-default-green rounded-full py-1.5"
              >
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Blob Image  Mobile view -->

<div class="block sm:hidden relative -mt-20 z-20 w-full">
  <div class="heroCurve3Container relative">
    <svg height="0" width="0"
      ><defs
        ><clipPath id="hero-curve-3" clipPathUnits="objectBoundingBox"
          ><path
            d="M1 .074v.904S.906 1 .774 1C.706 1 .637.996.569.993.487.989.405.984.324.986a4.576 4.576 0 0 0-.117.005C.115.996.032 1.001 0 .986V.074C.062.024.147 0 .282 0c.075 0 .165.023.244.043.062.016.118.03.154.03.026 0 .06-.007.097-.014C.861.044.959.025 1 .074"
          ></path>
        </clipPath>
      </defs>
    </svg>

    <img
      src={url +
      page.Intro_blob.data.attributes.provider_metadata.public_id +
      `/small`}
      class="w-full h-full"
      style="clip-path: url(#hero-curve-3);"
    />

    <div class="absolute bottom-0 w-full progressContainer">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 375 130.6"
        class="relative z-40 bottom-0"
      >
        <path
          d="M0,0H375V124.1s-35.1,6.5-84.6,6.5c-25.5,0-51.2-1.1-76.9-2.1-30.8-1.3-61.6-2.6-92-2.1-14.4.3-29.5,1-44,1.6-34.4,1.5-65.7,2.9-77.5-1.6Z"
          style="fill-opacity:0.75;fill-rule:evenodd"></path>
      </svg>

      <div
        class="absolute inset-0 z-50 w-auto flex justify-center mx-auto wrapper"
      >
        <div class="progressContent">
          <div class="progressHeader">
            €<span class="total-amount-raised">{totalAmountRaised}</span>
          </div>
          <div class="flex flex-wrap gap-x-1.5 justify-between">
            <div class="progeressTxt">{page.Heading_goal}</div>
            <div class="progeressTxt">
              <span class="progeressTxtNum">{supportersCount}</span>
              {page.Heading_supporters}
            </div>
          </div>
          <div
            class="mt-1 sm:mt-2 md:mt-3 w-full bg-default-light-gray rounded-full"
          >
            <div
              style="width: 0%"
              class="progress-bar bg-default-green rounded-full py-1.5"
            >
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script
  defer
  define:vars={{ initialProgress, finalProgress, animationDuration }}
>
  const progressBars = document.querySelectorAll(".progress-bar");

  progressBars.forEach((progressBar) => {
    progressBar.animate(
      { width: [initialProgress, finalProgress] },
      animationDuration
    ).onfinish = () => {
      progressBar.style.width = finalProgress;
    };
  });
</script>

<!-- Plans Section -->

<div class="wrapper planSec" role="main">
  <h2 class="header-default color-default" id="plans">{page.Heading_plans}</h2>
  <PlanCards allPlans={page.allPlans} />
</div>

<!-- Info Section -->

<div class="crowdHomeInfo overflow-hidden relative">
  <!-- Background -->
  <div class="absolute z-10 -top-10 sm:top-0 -left-0.5 w-screen h-full">
    <svg width="0" height="0">
      <defs>
        <clipPath id="crowdHomeInfoImgFrame" clipPathUnits="objectBoundingBox">
          <path
            d="M1,0.055 S0.962,-0.005,0.847,0 C0.729,0.006,0.602,0.049,0.484,0.044 C0.381,0.04,0.239,0.018,0.136,0.028 C0.073,0.034,0,0.055,0,0.055 V0.965 s0.032,0.035,0.156,0.035 c0.061,0,0.136,-0.012,0.193,-0.027 c0.06,-0.016,0.161,-0.017,0.231,-0.017 c0.074,0,0.2,0.037,0.315,0.01 s0.106,-0.071,0.106,-0.071 V0.055"
          ></path>
        </clipPath>
      </defs>
    </svg>

    <img
      src={Sec3BG}
      class="h-full w-full"
      style="clip-path: url(#crowdHomeInfoImgFrame)"
    />
  </div>

  <!-- Blob Image  Desktop view-->

  <div
    class="hidden sm:block absolute left-0 z-20 w-full sm:w-1/2 h-full items-center"
  >
    <div class="w-auto h-full crowdHomeInfo_Curve1">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 1020 696.3"
        class="w-auto h-full"
      >
        <defs>
          <clipPath id="crowdHomeInfo_ImgFrame1">
            <path
              d="M1020,344.2c0,1.7,0,3.4-.1,5.1v4.5a19.3,19.3,0,0,0-.1,2.4c-.1,2.4-.1,4.8-.2,7.2s-.1,2.6-.1,3.9a24.4,24.4,0,0,0-.1,2.7c-.6,12.8-1.3,24.3-2.3,33.8-7.1,79.7-12.3,192.7-166.2,254.7-84.2,33.9-156.3,37.9-226.7,34.5-47.1-2.2-93.5-7.7-142.3-9.7-11.7-.5-23.6-.8-35.7-.8-83,0-165.9,14.1-238.9,13.8-47.6-.2-91.1-6.7-127.3-27.5-91.6-52.5-61.9-211.3-61.9-331.1C18.1,275.6,5.3,235,1.2,192.8v-.3A195.2,195.2,0,0,1,0,169.6c-.1-26.2,4.3-54.4,18.1-89.8C42.3,17.5,108.2,2.7,192.3,2.4c72.4-.3,158.3,10.1,242.6,10.1,7.2,0,14.9-.2,23.1-.5,44.4-1.8,102.7-7.8,164.9-10.6C722.5-3,832.1.9,910.5,44.1c84.4,46.5,106.2,172.7,109.2,269,0,2.1.1,4.2.1,6.3s.1,3,.1,4.4.1,4.5.1,6.7Z"
            ></path>
          </clipPath>
        </defs>
        <image
          class="hidden lg:block w-auto h-full"
          height="100%"
          width="100%"
          href={url +
          page.Block_blob.data.attributes.provider_metadata.public_id +
          `/cms`}
          clip-path="url(#crowdHomeInfo_ImgFrame1)"
        />
        <image
          class="block lg:hidden w-auto h-full"
          height="100%"
          width="100%"
          x="20%"
          href={url +
          page.Block_blob.data.attributes.provider_metadata.public_id +
          `/cms`}
          clip-path="url(#crowdHomeInfo_ImgFrame1)"
        />
      </svg>
    </div>
  </div>

  <!-- Text content -->

  <div class="relative h-full wrapper z-30" role="complementary">
    <div class="w-full h-full justify-end flex flex-wrap">
      <div
        class="w-full sm:w-1/2 h-full flex sm:items-center crowdHomeInfoContent"
      >
        <div class="relative">
          <h2 class="header-default crowdHomeInfoHeader">
            {page.Heading_block}
            <span class="icon relative top-2">
              <span class="relative headingInlineIcon">
                <img class="w-full h-full" src={FlowerIcon} alt="flower-icon" />
              </span>
            </span>
          </h2>
          <div class="pt-0.5 mt-7 sm:mt-12 prose max-w-none crowdHomeInfoTxt">
            <Markdown>{page.Block_text}</Markdown>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Blob Image  Mobile view-->

<div class="block sm:hidden relative -mt-28 z-20 w-full">
  <div class="w-screen">
    <svg width="0" height="0"
      ><defs
        ><clipPath id="crowdHomeInfoImgFrame2" clipPathUnits="objectBoundingBox"
          ><path
            d="M.282 0C.147 0 .062.021 0 .064V.97c.045.046.195.006.324 0C.473.963.625 1 .774 1A.561.561 0 0 0 1 .954v-.89c-.059-.061-.237 0-.32 0S.417 0 .282 0"
          ></path>
        </clipPath>
      </defs>
    </svg>

    <img
      src={url +
      page.Block_blob.data.attributes.provider_metadata.public_id +
      `/small`}
      class="h-full w-full"
      style="clip-path: url(#crowdHomeInfoImgFrame2)"
    />
  </div>
</div>

<div class="separator"></div>
