---
import { Img } from "astro-imagetools/components";

import CMS from "@store/CMS";
import RecurringImages from "@store/RecurringImages";

import ClipPathSVG from "@components/ClipPathSVG.astro";
import AdvancedNotification from "@components/AdvancedNotification.astro";

const { green_right_arrow } = RecurringImages;

const { page, recurData } = Astro.props,
  { Title, locale } = page;

const userAccountRecurData = CMS.get("userAccountRecurringElement", locale);

const {
  Button_track_package,
  Button_track_package_text,
  Button_buy_again_text,
  Button_sold_out_text,
  Label_order,
  text_estimated_delivery,
  text_estimated_shipment,
  text_delivered,
  text_show_more_products_in_this_order,
  text_hide_more_products_in_this_order,
} = userAccountRecurData;
---

<style lang="scss">
  @use "src/styles/poly-fluid" as *;
  @use "src/styles/colors";

  .dashboard-sec-title {
    @apply bg-primary leading-[110%] text-secondary-light rounded-[10px];

    font-size: clamp(2rem, 3vw + 0.55rem, 2.625rem);
    padding: 15px clamp(15px, 2.2vw + 0.1rem, 35px);

    @media (max-width: 767.98px) {
      padding: 15px;
    }
  }

  .dashboard-sec {
    @apply bg-secondary-light rounded-[10px] m-0;

    padding: clamp(15px, 2.08vw + 0.01rem, 25px)
      clamp(15px, 2.2vw + 0.1rem, 35px);

    @media (max-width: 767.98px) {
      padding: 15px;
    }

    h2 {
      @apply text-[clamp(1.25rem,1.5vw+0.15rem,1.5rem)] font-bold text-primary;
    }

    .order-item {
      @apply grid gap-[25px] sm:gap-[30px];

      .order-img {
        width: poly-fluid-clamp(
          (
            640px: 50px,
            1440px: 65px,
          )
        );
      }

      .order-item-label {
        @apply flex items-center gap-2 text-lg font-bold leading-[150%] text-black;
      }

      .order-item-date {
        @apply text-sm sm:text-base text-black-light;
      }

      .order-item-title {
        @apply font-bold text-[clamp(1.25rem,1.5vw+0.15rem,1.5rem)];
      }

      .order-item-info {
        @apply flex flex-wrap gap-1 sm:gap-2 text-sm sm:text-base text-black-light;
      }

      .order-item-quantity {
        @apply text-sm sm:text-base font-semibold text-black-light;
      }

      .order-item-cart-btn {
        @apply flex gap-1 sm:gap-2 w-fit py-[5px] sm:py-2.5 px-3 sm:px-5
          text-sm sm:text-base font-semibold sm:font-bold text-white bg-primary rounded-full;

        &:disabled,
        &[disabled] {
          @apply bg-black/60 text-secondary-light cursor-not-allowed;
        }
      }

      .show-more-toggle-btn {
        @apply flex gap-1 sm:gap-2 items-center font-bold text-primary;
      }
    }
  }

  .month-container {
    @apply grid grid-cols-[repeat(auto-fit,minmax(90px,1fr))] gap-[15px] items-center w-full;

    .month {
      @apply flex;

      input[type="checkbox"] {
        @apply w-full hidden;

        &:checked + label {
          @apply text-white font-bold bg-primary;
        }
      }

      label {
        @apply grow w-full px-5 py-2.5 font-medium text-primary text-center select-none cursor-pointer rounded-full;
      }
    }

    .active {
      @apply font-bold text-white bg-primary;
    }
  }
</style>

<ClipPathSVG
  id="orders-blob-curve"
  path="M0.517,0.008 C0.36,0.008,0.1,-0.008,0.04,0.082 S0.002,0.495,0.018,0.737 S0.182,1,0.528,1 c0.286,0,0.375,-0.063,0.447,-0.282 c0.031,-0.094,0.047,-0.323,-0.029,-0.591 C0.898,-0.045,0.734,0.008,0.517,0.008"
/>

<div class="wrapper py-[50px] w-full flex flex-wrap">
  <div class="w-full md:w-2/3 order-2 md:order-1">
    <section class="grid gap-[25px] sm:gap-[30px]">
      <h1 class="dashboard-sec-title recoleta">
        {Title}
      </h1>

      <div id="month-1" class="dashboard-sec grid gap-[25px] sm:gap-[30px]">
        <h2>January 2022</h2>

        <div
          class="order-item pb-[25px] sm:pb-[30px] border-b border-primary-light"
        >
          <div
            class="flex flex-wrap items-center gap-[5px] sm:gap-2.5 justify-between"
          >
            <div class="grid gap-[5px] sm:gap-2.5">
              <div class="order-item-label">
                {Label_order} #132131

                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 8 16"
                  class="h-4"
                >
                  <path
                    d="M.3,16.3a1.4,1.4,0,0,1,0-1.7L5.4,8.3.3,2.1A1.1,1.1,0,0,1,0,1.3,1.7,1.7,0,0,1,.3.3,1.1,1.1,0,0,1,1.1,0a.9.9,0,0,1,.7.3L7.7,7.5a1.1,1.1,0,0,1,.3.8,1.7,1.7,0,0,1-.3,1l-5.9,7a.7.7,0,0,1-.7.4A.9.9,0,0,1,.3,16.3Z"
                  ></path>
                </svg>
              </div>

              <div class="order-item-date">
                {text_estimated_delivery} 18-Jan-2023
              </div>
            </div>

            {
              Button_track_package && (
                <a
                  href="#"
                  class="py-2.5 px-5 font-bold text-white bg-primary rounded-full"
                >
                  {Button_track_package_text}
                </a>
              )
            }
          </div>

          <div class="flex gap-2.5 sm:gap-[15px]">
            <div class="oder-img">
              <Img
                layout="fullWidth"
                width={65}
                alt=""
                attributes={{
                  img: {
                    style:
                      "aspect-ratio: 1 / 1; clip-path: url(#orders-blob-curve)",
                  },
                }}
                src="https://cms.dilmahtea.me/uploads/rose_with_french_vanilla_with_t_column_be315af184.jpg"
              />
            </div>

            <div class="grow grid gap-[5px] sm:gap-2.5">
              <div class="grid gap-[5px] sm:gap-2.5">
                <div class="order-item-title recoleta line-height-[110%]">
                  Ceylon cinnamon spice tea
                </div>
                <div class="order-item-info">
                  <span>20 tea bags</span>
                  <span>&#8226;</span>
                  <span>100gm</span>
                  <span>&#8226;</span>
                  <span>True organincs</span>
                  <span>&#8226;</span>
                  <span>Black tea</span>
                </div>
              </div>

              <div
                class="flex flex-wrap gap-[5px] sm:gap-2.5 items-center justify-between"
              >
                <div class="order-item-quantity">Quantity: 1</div>

                <button data-sku={`SKU`} class="order-item-cart-btn">
                  {Button_buy_again_text}
                  <span class="text-secondary-light">&#8226;</span>
                  <span class="recoleta font-bold">€24</span>
                </button>
              </div>
            </div>
          </div>

          <div class="flex gap-2.5 sm:gap-[15px]">
            <div class="oder-img">
              <Img
                layout="fullWidth"
                width={65}
                alt=""
                attributes={{
                  img: {
                    style:
                      "aspect-ratio: 1 / 1; clip-path: url(#orders-blob-curve)",
                  },
                }}
                src="https://cms.dilmahtea.me/uploads/rose_with_french_vanilla_with_t_column_be315af184.jpg"
              />
            </div>

            <div class="grow grid gap-[5px] sm:gap-2.5">
              <div class="grid gap-[5px] sm:gap-2.5">
                <div class="order-item-title recoleta line-height-[110%]">
                  Ceylon cinnamon spice tea
                </div>
                <div class="order-item-info">
                  <span>20 tea bags</span>
                  <span>&#8226;</span>
                  <span>100gm</span>
                  <span>&#8226;</span>
                  <span>True organincs</span>
                  <span>&#8226;</span>
                  <span>Black tea</span>
                </div>
              </div>

              <div
                class="flex flex-wrap gap-[5px] sm:gap-2.5 items-center justify-between"
              >
                <div class="order-item-quantity">Quantity: 1</div>

                <button class="order-item-cart-btn" disabled>
                  {Button_sold_out_text}
                  <span class="text-secondary-light">&#8226;</span>
                  <span class="recoleta font-bold">€24</span>
                </button>
              </div>

              <AdvancedNotification
                Type="Warning"
                Bordered={true}
                Rounded={true}
                Title="Item will be in stock by 23rd Feb 2023"
              />
            </div>
          </div>

          <div class="flex gap-2.5 sm:gap-[15px]">
            <div class="oder-img">
              <Img
                layout="fullWidth"
                width={65}
                alt=""
                attributes={{
                  img: {
                    style:
                      "aspect-ratio: 1 / 1; clip-path: url(#orders-blob-curve)",
                  },
                }}
                src="https://cms.dilmahtea.me/uploads/rose_with_french_vanilla_with_t_column_be315af184.jpg"
              />
            </div>

            <div class="grow grid gap-[5px] sm:gap-2.5">
              <div class="grid gap-[5px] sm:gap-2.5">
                <div class="order-item-title recoleta line-height-[110%]">
                  Ceylon cinnamon spice tea
                </div>
                <div class="order-item-info">
                  <span>20 tea bags</span>
                  <span>&#8226;</span>
                  <span>100gm</span>
                  <span>&#8226;</span>
                  <span>True organincs</span>
                  <span>&#8226;</span>
                  <span>Black tea</span>
                </div>
              </div>

              <div
                class="flex flex-wrap gap-[5px] sm:gap-2.5 items-center justify-between"
              >
                <div class="order-item-quantity">Quantity: 1</div>

                <button data-sku={`SKU`} class="order-item-cart-btn">
                  {Button_buy_again_text}
                  <span class="text-secondary-light">&#8226;</span>
                  <span class="recoleta font-bold">€24</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Max 3 items per order would be visible, otherwise toggle needed -->
          <div class="flex justify-center w-full">
            <div class="show-more-toggle-btn">
              <span
                >{
                  text_show_more_products_in_this_order.replace(
                    "<number>",
                    "10",
                  )
                }</span
              >

              <!-- after toggle show hide text
              <span>{text_hide_more_products_in_this_order.replace("<number>", "10")}</span> -->
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 16 8"
                class="w-4 fill-primary"
              >
                <path
                  d="M.3.3A1.1,1.1,0,0,1,1.1,0a.9.9,0,0,1,.7.3L7,5.5,12.2.3A1.1,1.1,0,0,1,13,0a.9.9,0,0,1,.7.3A.9.9,0,0,1,14,1a1.1,1.1,0,0,1-.3.8L7.8,7.7A1.1,1.1,0,0,1,7,8a.9.9,0,0,1-.7-.3L.3,1.8A1.1,1.1,0,0,1,0,1,.9.9,0,0,1,.3.3Z"
                ></path>
              </svg>
            </div>
          </div>
        </div>

        <div
          class="order-item pb-[25px] sm:pb-[30px] border-b border-primary-light"
        >
          <div
            class="flex flex-wrap items-center gap-[5px] sm:gap-2.5 justify-between"
          >
            <div class="grid gap-[5px] sm:gap-2.5">
              <div class="order-item-label">
                {Label_order} #132131

                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 8 16"
                  class="h-4"
                >
                  <path
                    d="M.3,16.3a1.4,1.4,0,0,1,0-1.7L5.4,8.3.3,2.1A1.1,1.1,0,0,1,0,1.3,1.7,1.7,0,0,1,.3.3,1.1,1.1,0,0,1,1.1,0a.9.9,0,0,1,.7.3L7.7,7.5a1.1,1.1,0,0,1,.3.8,1.7,1.7,0,0,1-.3,1l-5.9,7a.7.7,0,0,1-.7.4A.9.9,0,0,1,.3,16.3Z"
                  ></path>
                </svg>
              </div>

              <div class="order-item-date">
                {text_estimated_shipment} 28-Jan-2023
              </div>
            </div>

            {
              Button_track_package && (
                <a
                  href="#"
                  class="py-2.5 px-5 font-bold text-white bg-primary rounded-full"
                >
                  {Button_track_package_text}
                </a>
              )
            }
          </div>

          <div class="flex gap-2.5 sm:gap-[15px]">
            <div class="oder-img">
              <Img
                layout="fullWidth"
                width={65}
                alt=""
                attributes={{
                  img: {
                    style:
                      "aspect-ratio: 1 / 1; clip-path: url(#orders-blob-curve)",
                  },
                }}
                src="https://cms.dilmahtea.me/uploads/rose_with_french_vanilla_with_t_column_be315af184.jpg"
              />
            </div>

            <div class="grow grid gap-[5px] sm:gap-2.5">
              <div class="grid gap-[5px] sm:gap-2.5">
                <div class="order-item-title recoleta line-height-[110%]">
                  Ceylon cinnamon spice tea
                </div>
                <div class="order-item-info">
                  <span>20 tea bags</span>
                  <span>&#8226;</span>
                  <span>100gm</span>
                  <span>&#8226;</span>
                  <span>True organincs</span>
                  <span>&#8226;</span>
                  <span>Black tea</span>
                </div>
              </div>

              <div
                class="flex flex-wrap gap-[5px] sm:gap-2.5 items-center justify-between"
              >
                <div class="order-item-quantity">Quantity: 1</div>

                <button data-sku={`SKU`} class="order-item-cart-btn">
                  {Button_buy_again_text}
                  <span class="text-secondary-light">&#8226;</span>
                  <span class="recoleta font-bold">€24</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="order-item">
          <div
            class="flex flex-wrap items-center gap-[5px] sm:gap-2.5 justify-between"
          >
            <div class="grid gap-[5px] sm:gap-2.5">
              <div class="order-item-label">
                {Label_order} #132131

                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 8 16"
                  class="h-4"
                >
                  <path
                    d="M.3,16.3a1.4,1.4,0,0,1,0-1.7L5.4,8.3.3,2.1A1.1,1.1,0,0,1,0,1.3,1.7,1.7,0,0,1,.3.3,1.1,1.1,0,0,1,1.1,0a.9.9,0,0,1,.7.3L7.7,7.5a1.1,1.1,0,0,1,.3.8,1.7,1.7,0,0,1-.3,1l-5.9,7a.7.7,0,0,1-.7.4A.9.9,0,0,1,.3,16.3Z"
                  ></path>
                </svg>
              </div>

              <div class="order-item-date">
                {text_delivered} 10-Jan-2023
              </div>
            </div>
          </div>

          <div class="flex gap-2.5 sm:gap-[15px]">
            <div class="oder-img">
              <Img
                layout="fullWidth"
                width={65}
                alt=""
                attributes={{
                  img: {
                    style:
                      "aspect-ratio: 1 / 1; clip-path: url(#orders-blob-curve)",
                  },
                }}
                src="https://cms.dilmahtea.me/uploads/rose_with_french_vanilla_with_t_column_be315af184.jpg"
              />
            </div>

            <div class="grow grid gap-[5px] sm:gap-2.5">
              <div class="grid gap-[5px] sm:gap-2.5">
                <div class="order-item-title recoleta line-height-[110%]">
                  Ceylon cinnamon spice tea
                </div>
                <div class="order-item-info">
                  <span>20 tea bags</span>
                  <span>&#8226;</span>
                  <span>100gm</span>
                  <span>&#8226;</span>
                  <span>True organincs</span>
                  <span>&#8226;</span>
                  <span>Black tea</span>
                </div>
              </div>

              <div
                class="flex flex-wrap gap-[5px] sm:gap-2.5 items-center justify-between"
              >
                <div class="order-item-quantity">Quantity: 1</div>

                <button data-sku={`SKU`} class="order-item-cart-btn">
                  {Button_buy_again_text}
                  <span class="text-secondary-light">&#8226;</span>
                  <span class="recoleta font-bold">€24</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div
    class:list={[
      "w-full md:w-1/3 self-start hidden md:flex flex-col gap-[50px] md:sticky",
      "top-0 text-black overflow-hidden order-1 md:order-2",
      "md:pl-[clamp(24px,3.8vw+0.16px,50px)] lg:pl-[clamp(70px,11.3125vw-46px,128px)]",
    ]}
  >
    <div role="complementary" aria-label="Chapters" id="headings">
      <h3
        id="headings-header"
        class="pb-2.5 lg:pb-5 xl:pb-[30px] text-[clamp(1.5rem,2vw+0.2rem,2rem)] font-bold"
      >
        Chapters
      </h3>

      <div
        role="list"
        class="heading-content flex flex-col gap-[15px] text-2xl leading-[130%] lg:leading-[150%] overflow-y-auto"
      >
        <a
          role="listitem"
          href="#month-1"
          class="flex items-center text-black-light font-bold text-primary"
        >
          <div
            class="w-[clamp(37px,4.6875vw-18.75px,45px)] mr-[clamp(10px,4.6875vw-43.75px,20px);] lnline-flex"
          >
            <img {...green_right_arrow} />
          </div>

           January
        </a>

        <a
          role="listitem"
          href={`#`}
          class="flex items-center text-black-light"
        >
          <div
            class="w-[clamp(37px,4.6875vw-18.75px,45px)] mr-[clamp(10px,4.6875vw-43.75px,20px);] lnline-flex opacity-0"
          >
            <img {...green_right_arrow} />
          </div>

           February
        </a>
      </div>
    </div>

    <div
      class="grid gap-[25px] lg:gap-[30px] p-[35px] bg-secondary-light rounded-[10px]"
    >
      <div class="font-bold text-black-light">Date range</div>

      <div class="flex items-center justify-between gap-2.5">
        <svg
          id="year-selector-arrow-left"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 8 14"
          class="w-[18px] h-[18px] fill-primary cursor-pointer"
        >
          <path
            d="M7.7,13.7a1.1,1.1,0,0,0,.3-.8,1.1,1.1,0,0,0-.3-.7L2.5,7,7.7,1.8A1.1,1.1,0,0,0,8,1,1.1,1.1,0,0,0,7.7.3,1.1,1.1,0,0,0,7,0a1.1,1.1,0,0,0-.8.3L.3,6.2A1.1,1.1,0,0,0,0,7a.9.9,0,0,0,.3.7l5.9,6A1.1,1.1,0,0,0,7,14a1.1,1.1,0,0,0,.7-.3Z"
          ></path>
        </svg>

        <select
          id="year-selector"
          class:list={[
            "grow text-[clamp(1.25rem,1.5vw+0.15rem,1.5rem)] font-bold",
            "text-primary text-center bg-transparent appearance-none",
          ]}
        >
          <option class="select-none">2021</option>
          <option class="select-none" selected>2022</option>
          <option class="select-none">2023</option>
        </select>

        <svg
          id="year-selector-arrow-right"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 8 14"
          class="w-[18px] h-[18px] fill-primary cursor-pointer"
        >
          <path
            d="M.3,13.7a1.1,1.1,0,0,1-.3-.8,1.1,1.1,0,0,1,.3-.7L5.5,7,.3,1.8A1.1,1.1,0,0,1,0,1,1.1,1.1,0,0,1,.3.3,1.1,1.1,0,0,1,1,0a1.1,1.1,0,0,1,.8.3L7.7,6.2A1.1,1.1,0,0,1,8,7a.9.9,0,0,1-.3.7l-5.9,6A1.1,1.1,0,0,1,1,14a1.1,1.1,0,0,1-.7-.3Z"
          ></path>
        </svg>
      </div>

      <div class="month-container">
        <div class="month">
          <input type="checkbox" id="jan" checked />
          <label for="jan">Jan</label>
        </div>
        <div class="month">
          <input type="checkbox" id="feb" checked />
          <label for="feb">Feb</label>
        </div>
        <div class="month">
          <input type="checkbox" id="mar" />
          <label for="mar">Mar</label>
        </div>
        <div class="month">
          <input type="checkbox" id="apr" />
          <label for="apr">Apr</label>
        </div>
        <div class="month">
          <input type="checkbox" id="may" />
          <label for="may">May</label>
        </div>
        <div class="month">
          <input type="checkbox" id="jun" />
          <label for="jun">Jun</label>
        </div>
        <div class="month">
          <input type="checkbox" id="jul" />
          <label for="jul">Jul</label>
        </div>
        <div class="month">
          <input type="checkbox" id="aug" />
          <label for="aug">Aug</label>
        </div>
        <div class="month">
          <input type="checkbox" id="sep" />
          <label for="sep">Sep</label>
        </div>
        <div class="month">
          <input type="checkbox" id="oct" />
          <label for="oct">Oct</label>
        </div>
        <div class="month">
          <input type="checkbox" id="nov" />
          <label for="nov">Nov</label>
        </div>
        <div class="month">
          <input type="checkbox" id="dec" />
          <label for="dec">Dec</label>
        </div>
      </div>

      <div class="w-full flex justify-end">
        <div class="font-bold text-primary cursor-pointer">Clear range</div>
      </div>
    </div>
  </div>
</div>

<script is:inline>
  const id = document.getElementById.bind(document),
    yearSelector = id("year-selector"),
    yearSelectorOptions = Array.from(yearSelector?.options),
    btnLeft = id("year-selector-arrow-left"),
    btnRight = id("year-selector-arrow-right");

  btnLeft?.addEventListener("click", () => changeSelected(true));
  btnRight?.addEventListener("click", () => changeSelected(false));

  function changeSelected(index) {
    const currentIndex = yearSelectorOptions.findIndex(
      (option) => option.value === yearSelector.value,
    );
    const newIndex = index
      ? Math.max(0, currentIndex - 1)
      : Math.min(yearSelectorOptions.length - 1, currentIndex + 1);
    yearSelector.value = yearSelectorOptions[newIndex]?.value;
  }
</script>
