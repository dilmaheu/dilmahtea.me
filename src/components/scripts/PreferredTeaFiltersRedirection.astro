---
const { variant, size } = Astro.props.page;
---

<script define:vars={{ variant, size }}>
  const preferredFilters = JSON.parse(
    localStorage.getItem("preferredFilters") || "{}"
  );

  if (variant) preferredFilters.tea_variant = variant;
  if (size) preferredFilters.tea_size = size;

  localStorage.setItem("preferredFilters", JSON.stringify(preferredFilters));

  // support both product overview & category filters redirection
  if (/^\/[a-z]{2}\/[a-z-]+\/?$/.test(location.pathname)) {
    const { tea_variant, tea_size } = preferredFilters,
      redirectPath = (
        location.pathname.replace(/\/$/, "") +
        `${tea_variant ? "/" + tea_variant : ""}` +
        `${tea_size ? "/" + tea_size : ""}`
      )
        .toLowerCase()
        .replaceAll(" ", "-");

    if (redirectPath !== location.pathname.replace(/\/$/, "")) {
      location.pathname = redirectPath;
    }
  }
</script>
