---
const { variant, size } = Astro.props;
---

<script define:vars={{ variant, size }}>
  if (!variant || !size) {
    const productsContainer = document.currentScript.previousElementSibling;

    window.preferredProductsVariants ??= JSON.parse(
      localStorage.getItem("preferredProductsVariants") || "{}"
    );

    Object.keys(preferredProductsVariants).forEach((baseProductTitle) => {
      const variants = productsContainer.querySelectorAll(
        `[data-base-product-title="${baseProductTitle}"]`
      );

      if (variants.length > 1) {
        const { tea_variant, tea_size } =
          preferredProductsVariants[baseProductTitle];

        const variantKey = variant
          ? tea_size
          : size
          ? tea_variant
          : `${tea_variant} | ${tea_size}`;

        Array.from(variants)
          .filter((variant) => {
            if (variant.dataset.variantKey === variantKey) {
              variant.classList.remove("hidden");
            } else {
              return true;
            }
          })
          .forEach((variant) => {
            variant.classList.add("hidden");
          });
      }
    });
  }
</script>
