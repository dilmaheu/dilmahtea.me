---
import CMS from "@store/CMS";

import Chapters from "@components/Chapters.astro";

import localizeCMSImage from "@utils/localizeCMSImage";
import ChaptersFunctionality from "@scripts/ChaptersFunctionality.astro";

const { page, headings } = Astro.props;

const { locale, type, Breadcrumb } = page;

const recurData = CMS.get("recurringElement", locale),
  userAccountDashboard = CMS.get("userAccountDashboard", locale),
  userAccountRecurData = CMS.get("userAccountRecurringElement", locale);

const { Support, Support_visibility } = userAccountDashboard;

const headingName =
  (type === "accountOrders" && userAccountRecurData.text_orders_timeline) ||
  recurData.text_chapter;
---

<style lang="scss" is:global>
  @use "src/styles/poly-fluid" as *;

  @mixin division-gap {
    @apply gap-[clamp(25px,calc(0.625vw+21px),30px)];
  }

  @mixin division-in-gap {
    @apply gap-[clamp(10px,calc(0.625vw+6px),15px)];
  }

  @mixin division-in-element-gap {
    @apply gap-[clamp(5px,calc(0.625vw+1px),10px)];
  }

  @mixin tiled-div-pad {
    @apply p-[clamp(15px,calc(2.5vw-1px),35px)];
  }

  @mixin tiled-title-div-pad {
    @apply py-[15px] px-[clamp(15px,calc(2.5vw-1px),35px)];
  }

  @mixin form-gap {
    @apply gap-[clamp(15px,calc(1.25vw+7px),25px)];
  }

  @mixin tiled-form {
    @apply p-[clamp(10px,calc(1.25vw+2px),20px)]
      bg-primary-light/30 border border-primary rounded-[10px];
  }

  @mixin text-h2 {
    @apply text-[clamp(28px,calc(1.75vw+16.8px),42px)] leading-[140%];
  }

  @mixin text-h3 {
    @apply text-[clamp(24px,calc(1vw+17.6px),32px)] leading-[140%];
  }

  @mixin text-h4 {
    @apply text-[clamp(24px,calc(0.5vw+20.8px),28px)] leading-[150%];
  }

  @mixin text-h5 {
    @apply text-[clamp(20px,calc(0.5vw+16.8px),24px)] leading-[150%];
  }

  @mixin text-b3 {
    @apply text-[clamp(18px,calc(0.75vw+13.2px),24px)] leading-[150%];
  }

  @mixin text-b5 {
    @apply text-[clamp(16px,calc(0.25vw+14.4px),18px)] leading-[150%];
  }

  @mixin text-b7 {
    @apply text-[clamp(12px,calc(0.25vw+10.4px),14px)] leading-[150%];
  }

  @mixin button {
    @apply flex items-center justify-center gap-2 py-2.5 
      px-5 text-base font-bold cursor-pointer rounded-full;
  }

  @mixin button-link {
    @apply text-base font-bold cursor-pointer;
  }

  @mixin button-link {
    @apply text-base font-bold cursor-pointer;
  }

  @mixin button-link-big {
    @include text-b5;

    @apply font-bold cursor-pointer;
  }

  @mixin button-link-primary {
    @include button-link;

    @apply text-primary;
  }

  @mixin button-link-primary-big {
    @include button-link-big;

    @apply text-primary;
  }

  @mixin button-link-error-dark {
    @include button-link;

    @apply text-error-dark;
  }

  @mixin button-link-error-dark-big {
    @include button-link-big;

    @apply text-error-dark;
  }

  @mixin info-tag-button {
    @include text-b7;

    @apply py-1 px-2 rounded-full;

    line-height: 130% !important;
  }

  @mixin radio-button {
    @apply inline-block py-2.5 px-5 text-sm 
      border-2 rounded-full cursor-pointer select-none;
  }

  @mixin radio-button-extended {
    @include radio-button;

    @apply font-bold text-primary bg-white;
  }

  @mixin input-field-default {
    @apply bg-transparent border border-primary rounded-full 
      focus:ring focus:ring-primary-light focus:outline-none
      py-[clamp(8px,calc(0.25vw+6.4px),10px)] px-[clamp(15px,calc(0.625vw+11px),20px)]
      text-[clamp(16px,calc(0.25vw+14.4px),18px)] text-black placeholder:text-black-light;
  }

  @mixin selector-default {
    select {
      @include input-field-default;

      @apply w-full pr-[clamp(40px,calc(1.25vw+32px),50px)] cursor-pointer appearance-none;

      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 14 8'%3E%3Cpath d='M.3.3A1.1,1.1,0,0,1,1.1,0a.9.9,0,0,1,.7.3L7,5.5,12.2.3A1.1,1.1,0,0,1,13,0a.9.9,0,0,1,.7.3A.9.9,0,0,1,14,1a1.1,1.1,0,0,1-.3.8L7.8,7.7A1.1,1.1,0,0,1,7,8a.9.9,0,0,1-.7-.3L.3,1.8A1.1,1.1,0,0,1,0,1,.9.9,0,0,1,.3.3Z' style='fill:%231e4848'/%3E%3C/svg%3E")
        no-repeat right 20px center;
      background-size: clamp(14px, calc(0.25vw + 12.4px), 16px);
    }
  }

  @mixin input-label {
    @include text-b5;

    @apply font-semibold text-black-light;
  }

  @mixin input-text-large {
    @include text-b3;

    @apply text-black;
  }

  .division-gap {
    @include division-gap;
  }

  .division-in-gap {
    @include division-in-gap;
  }

  .division-in-element-gap {
    @include division-in-element-gap;
  }

  .tiled-div-pad {
    @include tiled-div-pad;
  }

  .tiled-title-div-pad {
    @include tiled-title-div-pad;
  }

  .form-gap {
    @include form-gap;
  }

  .tiled-form {
    @include tiled-form;
  }

  .text-h2 {
    @include text-h2;
  }

  .text-h3 {
    @include text-h3;
  }

  .text-h4 {
    @include text-h4;
  }

  .text-h5 {
    @include text-h5;
  }

  .text-b3 {
    @include text-b3;
  }

  .text-b5 {
    @include text-b5;
  }

  .text-b7 {
    @include text-b7;
  }

  .input-field-default {
    input {
      @include input-field-default;
    }
  }

  .selector-default {
    @include selector-default;
  }

  .input-label {
    @include input-label;
  }

  .input-text-large-static {
    @include input-text-large;
  }

  .input-text-large {
    @include input-text-large;

    @apply w-full bg-transparent outline-none;

    &:not(:disabled) {
      @apply border-b-2 border-primary;
    }

    &.errored {
      @apply border-error;
    }
  }

  .button-primary {
    @include button;

    @apply bg-primary text-white;
  }

  .button-link-primary {
    @include button-link-primary;
  }

  .button-link-primary-big {
    @include button-link-primary-big;
  }

  .button-link-error-dark {
    @include button-link-error-dark;
  }

  .button-link-error-dark-big {
    @include button-link-error-dark-big;
  }

  .info-tag-button {
    @include info-tag-button;

    @apply text-black-light bg-white;
  }

  .info-tag-button-primary {
    @include info-tag-button;

    @apply text-white bg-primary;
  }

  .radio-button-default {
    @include radio-button;
  }

  .radio-button-extended {
    @include radio-button-extended;
  }

  .checkbox-primary {
    @include text-b5;
    @include division-in-element-gap;

    @apply flex items-center text-black-light cursor-pointer select-none;

    .checkbox-input-container {
      @apply relative block w-5 h-5;

      & input {
        @apply absolute opacity-0;

        &:checked ~ .checkbox-primary {
          @apply bg-primary rounded;

          &::after {
            @apply bg-transparent opacity-100;
          }
        }
      }

      & .checkbox-primary {
        @apply absolute w-[18px] sm:w-5 h-[18px] sm:h-5 
          bg-transparent rounded border-2 border-primary;

        &::after {
          @apply text-sm font-bold text-white content-['âœ“'] 
            absolute -top-[3px] sm:-top-0.5 left-0.5 sm:left-[3px] opacity-0;
        }
      }
    }
  }

  .quick-info {
    @include text-b7;

    @apply flex items-center gap-[clamp(4px,calc(0.5vw+0.8px),8px)] font-medium text-black-light;
  }

  .horizontal-toggle-button-primary {
    @apply flex items-center cursor-pointer
      gap-[clamp(4px,calc(0.5vw+0.8px),8px)] text-base font-bold text-primary;

    .toggle-button-arrow {
      @apply w-[14px] h-2;
    }
  }

  .form-grid {
    @include form-gap;
    @include selector-default;
    input {
      @include input-field-default;
    }

    @apply w-full grid sm:grid-cols-2;

    label {
      @include division-in-element-gap;

      @apply flex flex-col;

      span.tag-input-close-button {
        @apply absolute inset-y-0 right-0 cursor-pointer
          flex items-center pr-5 font-bold text-error-dark;
      }
    }
  }

  .form-button-container {
    @include division-gap;

    @apply flex flex-wrap items-center justify-center sm:justify-start;
  }

  .dashboard-sec-title {
    @include text-h2;
    @include tiled-title-div-pad;

    @apply bg-primary text-white rounded-[10px];
  }

  .dashboard-sec {
    @include tiled-div-pad;

    @apply bg-secondary-light rounded-[10px] text-black;

    .information-btn {
      @apply leading-[150%] font-semibold text-primary;

      font-size: clamp(1rem, 1.4vw + 0.3rem, 1.375rem);
    }

    h2 {
      @include text-h2;

      @apply font-bold text-primary;
    }

    > a {
      order: 1;
    }

    .order-item {
      @apply grid gap-[25px] sm:gap-[30px];

      &:not(:last-child) {
        @apply border-b border-primary-light;
      }

      .order-img {
        width: poly-fluid-clamp(
          (
            640px: 50px,
            1440px: 65px,
          )
        );
      }

      .order-item-label {
        @apply flex items-center gap-2 text-lg font-bold leading-[150%] text-black;
      }

      .order-item-date {
        @apply text-sm sm:text-base text-black-light;
      }

      .order-item-title {
        @apply font-bold text-[clamp(1.25rem,1.5vw+0.15rem,1.5rem)];
      }

      .order-item-info {
        @apply flex flex-wrap gap-1 sm:gap-2 text-sm sm:text-base text-black-light;
      }

      .order-item-quantity {
        @apply text-sm sm:text-base font-semibold text-black-light;
      }

      .order-item-cart-btn {
        @apply flex gap-1 sm:gap-2 w-fit py-[5px] sm:py-2.5 px-3 sm:px-5
          text-sm sm:text-base font-semibold sm:font-bold text-white bg-primary rounded-full;

        &:disabled,
        &[disabled] {
          @apply bg-black/60 text-secondary-light cursor-not-allowed;
        }
      }

      .show-more-toggle-btn {
        @apply flex gap-1 sm:gap-2 items-center font-bold text-primary cursor-pointer;
      }
    }
  }

  .month-container {
    @apply grid grid-cols-[repeat(auto-fit,minmax(90px,1fr))] gap-[15px] items-center w-full;

    a {
      @apply py-2.5 px-5 text-black-light font-medium text-center cursor-not-allowed rounded-full;

      &.selected,
      &.active {
        color: white !important;
        cursor: pointer !important;
      }

      &.selected {
        background-color: #547b7d !important;
      }

      &.active {
        background-color: #1e4848 !important;
        font-weight: bold;
      }
    }
  }
</style>

<div class="hero-sub-menu-shadow nav-bg"></div>

<div class="wrapper">
  {
    Breadcrumb && (
      <div
        role="banner"
        class="flex flex-wrap gap-2 recoleta text-2xl leading-[110%] text-primary mt-[25px]"
      >
        {Breadcrumb?.Steps.map(({ Link, Name }, index) => (
          <div class="flex items-center gap-2">
            {index > 0 && (
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="8"
                height="17"
                viewBox="0 0 8 16.7"
                class="fill-primary"
              >
                <path d="M.3,16.3a1.4,1.4,0,0,1,0-1.7L5.4,8.3.3,2.1A1.1,1.1,0,0,1,0,1.3,1.7,1.7,0,0,1,.3.3,1.1,1.1,0,0,1,1.1,0a.9.9,0,0,1,.7.3L7.7,7.5a1.1,1.1,0,0,1,.3.8,1.7,1.7,0,0,1-.3,1l-5.9,7a.7.7,0,0,1-.7.4A.9.9,0,0,1,.3,16.3Z" />
              </svg>
            )}
            <a href={Link || "#"}>{Name}</a>
          </div>
        ))}
      </div>
    )
  }
</div>

<section class="py-[50px]">
  <Chapters fixedTop={true} headingName={headingName} headings={headings}>
    <slot name="sticky-top-timeline" slot="top-slot" />
  </Chapters>

  <div
    class="wrapper w-full flex flex-col-reverse md:flex-row justify-between gap-[30px]"
  >
    <div class="md:w-2/3 2xl:w-1/2 md:min-w-[400px]">
      <div class="xl:w-5/6 2xl:w-full grid division-gap">
        <slot />
      </div>
    </div>

    <Chapters
      headingName={headingName}
      staticHeadings={headings}
      desktopOnly={true}
    >
      <slot name="timeline" />
    </Chapters>
  </div>
</section>

{
  Support_visibility && Support && (
    <div class="z-[999] fixed bottom-[clamp(15px,3vw+5px,50px)] right-[clamp(15px,3vw+5px,50px)]">
      <a href={Support.Button_link}>
        <div class="flex items-center gap-4 p-5 md:py-5 md:px-[34px] rounded-full bg-[#3C994E]">
          <div class="w-[45px] h-[45px]">
            <img
              class="w-full h-full object-contain"
              src={await localizeCMSImage(
                Support.Button_icon.data.attributes.url,
              )}
              alt={Support.Button_icon?.data?.attributes?.alternativeText}
            />
          </div>
          <div class="hidden md:block text-3xl text-white">
            {Support.Button_text}
          </div>
        </div>
      </a>
    </div>
  )
}

<!-- {headings?.length > 0 && <ChaptersFunctionality />} -->
