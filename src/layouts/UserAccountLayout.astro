---
import CMS from "@store/CMS";

import Chapters from "@components/Chapters.astro";

import localizeCMSImage from "@utils/localizeCMSImage";
import ChaptersFunctionality from "@scripts/ChaptersFunctionality.astro";

const { page, headings } = Astro.props;

const { locale, type, Breadcrumb } = page;

const recurData = CMS.get("recurringElement", locale),
  userAccountDashboard = CMS.get("userAccountDashboard", locale),
  userAccountRecurData = CMS.get("userAccountRecurringElement", locale);

const { Support, Support_visibility } = userAccountDashboard;

const headingName =
  (type === "accountOrders" && userAccountRecurData.text_orders_timeline) ||
  recurData.text_chapter;
---

<div class="hero-sub-menu-shadow nav-bg"></div>

<div class="wrapper">
  {
    Breadcrumb && (
      <div
        role="banner"
        class="flex flex-wrap gap-2 recoleta text-2xl leading-[110%] text-primary mt-[25px]"
      >
        {Breadcrumb?.Steps.map(({ Link, Name }, index) => (
          <div class="flex items-center gap-2">
            {index > 0 && (
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="8"
                height="17"
                viewBox="0 0 8 16.7"
                class="fill-primary"
              >
                <path d="M.3,16.3a1.4,1.4,0,0,1,0-1.7L5.4,8.3.3,2.1A1.1,1.1,0,0,1,0,1.3,1.7,1.7,0,0,1,.3.3,1.1,1.1,0,0,1,1.1,0a.9.9,0,0,1,.7.3L7.7,7.5a1.1,1.1,0,0,1,.3.8,1.7,1.7,0,0,1-.3,1l-5.9,7a.7.7,0,0,1-.7.4A.9.9,0,0,1,.3,16.3Z" />
              </svg>
            )}
            <a href={Link || "#"}>{Name}</a>
          </div>
        ))}
      </div>
    )
  }
</div>

<section class="py-[50px]">
  <Chapters fixedTop={true} headingName={headingName} headings={headings}>
    <slot name="sticky-top-timeline" slot="top-slot" />
  </Chapters>

  <div
    class="wrapper w-full flex flex-col-reverse md:flex-row justify-between gap-[30px]"
  >
    <div class="md:w-2/3 2xl:w-1/2 md:min-w-[400px]">
      <div class="xl:w-5/6 2xl:w-full grid division-gap">
        <slot />
      </div>
    </div>

    <Chapters
      headingName={headingName}
      staticHeadings={headings}
      desktopOnly={true}
    >
      <slot name="timeline" />
    </Chapters>
  </div>
</section>

{
  Support_visibility && Support && (
    <div class="z-[999] fixed bottom-[clamp(15px,3vw+5px,50px)] right-[clamp(15px,3vw+5px,50px)]">
      <a href={Support.Button_link}>
        <div class="flex items-center gap-4 p-5 md:py-5 md:px-[34px] rounded-full bg-[#3C994E]">
          <div class="w-[45px] h-[45px]">
            <img
              class="w-full h-full object-contain"
              src={await localizeCMSImage(
                Support.Button_icon.data.attributes.url,
              )}
              alt={Support.Button_icon?.data?.attributes?.alternativeText}
            />
          </div>
          <div class="hidden md:block text-3xl text-white">
            {Support.Button_text}
          </div>
        </div>
      </a>
    </div>
  )
}

<!-- {headings?.length > 0 && <ChaptersFunctionality />} -->
