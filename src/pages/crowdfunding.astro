---
import Layout from "../layouts/Layout.astro";

// getting the graphql query for fetch api
import CrowdFundingHomeQuery from "../queries/CrowdFundingHomeQuery";

// getting the Home component
import Home from "../components/Home.astro";

/**
 * This is the home page
 */

// fetching the home page
const crowdfundingDefaultPage = await fetch(`${import.meta.env.DB_URL}`, {
	method: "POST",
	headers: {
		"Content-Type": "application/json",
		Authorization: `Bearer ${import.meta.env.ACCESS_TOKEN}`,
	},
	body: JSON.stringify({
		query: CrowdFundingHomeQuery,
	}),
}).then((response) => response.json());

// saving it's page attributes like meta and other components
const homePage = crowdfundingDefaultPage.data.crowdfundingHome.data.attributes;
const allPlans = crowdfundingDefaultPage.data.crowdfundingPlans.data.map(
	(val) => val.attributes
);

const page = { ...homePage, allPlans };

const availableLocales = page.localizations.data.map((localized) =>
	localized.attributes.locale.substring(0, 2)
);

// saving footer text
const recurData = crowdfundingDefaultPage.data.recurringElement.data.attributes;
---

<Layout locale={page.locale.substring(0, 2)} availableLocales={availableLocales} meta={page.Meta} recurData={recurData}
	metaImage={page.Intro_blob.data.attributes.provider_metadata.public_id}>
	<Home page={page} />
</Layout>