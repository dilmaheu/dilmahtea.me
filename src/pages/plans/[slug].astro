---
import CrowdfundingForm from '../../components/CrowdfundingForm.astro';

export async function getStaticPaths() {
    const GqlQuery = `{
        crowdfundingPlans {
            data{
                id
                attributes{
                    Title
                }
            }
        }
    }`;

    
    const response = await fetch(`${import.meta.env.DB_URL}`,
       {
           method:'POST',
           headers: {
             'Content-Type':'application/json',
             'Authorization': `Bearer ${import.meta.env.ACCESS_TOKEN}`
           },
           body: JSON.stringify({
             query: GqlQuery,
           })
       });

    const data = await response.json();
    const posts = data.data.crowdfundingPlans.data;


    return posts.map((post) => {
        return {
            params: {slug: post.attributes.Title},
            props: {post: post.attributes}
        };
    });
}
const {slug} = Astro.params;
const {post} = Astro.props;
---

<CrowdfundingForm>
    <input type="hidden" id="planName" name="planName" value={post.Title} />
</CrowdfundingForm>
