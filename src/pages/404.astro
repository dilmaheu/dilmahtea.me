---
import Layout from "../layouts/Layout.astro";
import NotFound from "../components/NotFound.astro";
import NotFoundPagesQuery from "../queries/NotFoundPagesQuery";

// fetching the error page
const notFoundPagesData = await fetch(`${import.meta.env.DB_URL}`, {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    Authorization: `Bearer ${import.meta.env.ACCESS_TOKEN}`,
  },
  body: JSON.stringify({
    query: NotFoundPagesQuery,
  }),
}).then((response) => response.json());

// saving it's page attributes like meta and other components
const notFoundPages = notFoundPagesData.data.basicPages.data;

const locale = "en",
  page = notFoundPages.find(
    (page) => page.attributes.locale === locale
  ).attributes;

const availableLocales = page.localizations.data.map((localized) =>
  localized.attributes.locale.substring(0, 2)
);

// saving footer text
const recurData = notFoundPagesData.data.recurringElement.data.attributes;
---

<Layout
  locale={locale}
  availableLocales={availableLocales}
  meta={page.Meta}
  recurData={recurData}
  metaImage={page.Block_blob != null && page.Block_blob.data != null
    ? page.Block_blob.data.attributes.provider_metadata.public_id
    : recurData.OpenGraph_default.data.attributes.provider_metadata.public_id}
>
  <NotFound page={page} />
</Layout>
