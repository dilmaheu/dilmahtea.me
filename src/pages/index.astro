---
import Layout from '../layouts/Layout.astro';
// Getting the graphql query for fetch api
import CrowdFundingHomeQuery from '../queries/CrowdFundingHomeQuery'
// Getting the Home component
import Home from '../components/Home.astro';

/**
 * This is the default index page
 */

// Fetching the default home page
// No need for
const crowdfundingDefaultPage = await fetch(`${import.meta.env.DB_URL}`,
	{
		method: 'POST',
		headers: {
			'Content-Type': 'application/json',
			'Authorization': `Bearer ${import.meta.env.ACCESS_TOKEN}`
		},
		body: JSON.stringify({
			query: CrowdFundingHomeQuery,
		})
	}).then(response => response.json());

// Saving it's page attributes like meta and other components
const defPage = crowdfundingDefaultPage.data.crowdfundingHome.data.attributes;
const allPlans = crowdfundingDefaultPage.data.crowdfundingPlans.data.map(val => val.attributes);

const page = { ...defPage, allPlans }

const availableLocales = page.localizations.data.map((localized) => localized.attributes.locale.substring(0, 2));

// Saving footer text
const recurData = crowdfundingDefaultPage.data.recurringElement.data.attributes;

---

<Layout locale={page.locale.substring(0,2)} availableLocales={availableLocales} meta={page.Meta} recurData={recurData}
	metaImage={page.Intro_blob.data.attributes.provider_metadata.public_id}>
	<Home {page} />
</Layout>